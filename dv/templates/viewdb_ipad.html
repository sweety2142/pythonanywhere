<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags always come first -->
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> {% if check_comp == 'DB' %}
    <title>Do Best Ledger Manager Site</title>
    {% elif check_comp == 'EI' %}
    <title>EIN Textile Ledger Manager Site</title>
    {% endif %}
    <link rel="icon" href="{{ url_for('static', filename='images/ledger.png') }}">
    <link href="{{ url_for('static', filename='css/_bootstrap.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/_bootstrap_select_min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/w3.css') }}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/jquery-ui.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/theme.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/_STYLE.css') }}" rel="stylesheet">

    <link href="{{ url_for('static', filename='css/selectizejs/normalize.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/selectizejs/stylesheet.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/selectizejs/selectize.bootstrap3.css') }}" rel="stylesheet">

    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery-3.4.1.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/selectizejs/selectize.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery-ui.js') }}"></script>

    <style>
        .tn {
            background-color: transpatent;
            border: none;
        }
    </style>

</head>

<body class="w3-light-grey">

    <div class="w3-container">
        <h3> Active DataBase </h3>

        <div class="w3-bar w3-black">
            <button class="w3-bar-item w3-button tablink w3-red" onclick="openTabs(event, 'BUYER')">BUYER</button>
            <button class="w3-bar-item w3-button tablink" onclick="openTabs(event, 'Alldata')">All data</button>
            <!--button class="w3-bar-item w3-button tablink" onclick="openTabs(event, 'SPL2')">Sample 2</button-->
        </div>


        <div id="BUYER" class="w3-container w3-border tabs">
            <br>
            <span class="w3-padding-small nego_color w3-text-white">DB Buyer</span>
            <span class="w3-padding-small order_color w3-text-white">Add</span>
            <form action="{{ url_for('add_item_db_buyer') }}" method="POST">
                <table class="w3-table-all w3-card-4 w3-small w3-centered w3-border" style="overflow-x:auto;display:block">
                    <tr>
                        {% for item in db_data_buy %}
                        <th>{{ item }}</th>
                        {% endfor %}
                        <th style="background-color:#99e6ff">submit</th>
                    </tr>
                    <tr>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_code"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_buyer"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_prt_buyer"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_addr_1"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_addr_2"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_tel"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_fax"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_dam"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_jik"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_mail"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_mobile"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_level"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_bc"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input min_width_150" name="_grade_date"></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px">
                            <input type="text" class="w3-input" name="" value="" disabled></input>
                        </td>
                        <td class="w3-border" style="padding:0;height:25px;background-color:#99e6ff">
                            <input type="submit" class="w3-tag w3-khaki w3-round w3-text-grey"></input>
                        </td>
                    </tr>
                </table>
            </form>
            <br><br>
            <p></p>
            <span class="w3-padding-small shipment_color w3-text-white">DB Buyer</span>
            <span class="w3-padding-small order_color w3-text-white">Edit / Remove</span>
            <table class="w3-table-all w3-card-4 w3-small w3-centered w3-border" id="nt_buy" style="max-height:700px;display:block;overflow-x:auto;white-space:nowarp;">
            </table>
            <br>
            <div class="w3-container">
                <div class="w3-center">
                    <div class="w3-bar w3-border" style="width:100%">
                        <!--button href="#" class="w3-bar-item w3-button">&laquo;</button-->
                        {% for i in range(data_list_buy) %} {% set a = i * 100 %} {% if loop.last %} {% set b = total_count_buy %} {% else %} {% set b = a + 100 %} {% endif %}
                        <button href="#" name="pagination" value="{{a}},{{b}}_BUYER" class="w3-button">{{i+1}}</button> {% endfor %}
                    </div>
                </div>
            </div>
            <br><br><br><br>
        </div>


        <div id="Alldata" class="w3-container w3-border tabs" style="display:none">
            <br>
            <span class="w3-padding-small shipment_color w3-text-white">DataBase</span>
            <table class="w3-table-all w3-card-4 w3-small w3-centered w3-border" id="nt" style="max-height:700px;display:block;overflow-x:auto;white-space:nowarp;">
            </table>
            <br>
            <div class="w3-container">
                <div class="w3-center">
                    <div class="w3-bar w3-border" style="width:100%">
                        <!--button href="#" class="w3-bar-item w3-button">&laquo;</button-->
                        {% for i in range(data_list) %} {% set a = i * 100 %} {% if loop.last %} {% set b = total_count %} {% else %} {% set b = a + 100 %} {% endif %}
                        <button href="#" name="pagination" value="{{a}},{{b}}_alldata" class="w3-button">{{i+1}}</button> {% endfor %}
                    </div>
                </div>
            </div>
            <br><br><br><br>
        </div>
        <!-- end of Alldata -->



    </div>
    <!-- end of w3-container -->


    <script>
        function openTabs(evt, tabName) {
            var i, x, tablinks;
            x = document.getElementsByClassName("tabs");
            for (i = 0; i < x.length; i++) {
                x[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < x.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" w3-red", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " w3-red";
        }
    </script>



    <script>
        //items =['num','InvNo','DueDate','Buyer','Agent','LCNo','item','DN','LF','LS','a','b','c']

        $(window).on('load', function() {
            init_table();
            init_table_buyer();
        });
        $(document).on('keypress', 'input', function(e) {
            if (e.keyCode == 13) {
                $(this).next('input').focus();
            }
        })

        $(document).on('click', 'button[name="pagination"]', function() {
            data = String($(this).val());

            $.ajax({
                type: "POST",
                url: "{{ url_for('viewDB') }}",
                contentType: "application/json;charset=utf-8;",
                data: JSON.stringify({
                    inx: data
                }),
                success: function(out) {
                    if (out["db_name"] == 'alldata') {
                        $("#nt").empty();
                        add_table(out, "OrderNo", "#nt", "InvNo");
                    } else if (out["db_name"] == 'BUYER') {
                        $("#nt_buy").empty();
                        add_table(out, "Buyer", "#nt_buy", "Buyer");
                    }
                },
                error: function() {
                    alert("err");
                }
            });
        });


        function init_table() {
            { % autoescape false %
            }
            items = {
                {
                    db_data
                }
            }; { % endautoescape %
            }
            c = '';
            c += '<tr style="border-top:2px solid #66b3ff">';
            c += '    <th>num</th>';
            c += '    <th>Edit</th>';
            c += '    <th>Delete</th>';
            items.forEach(function(item) {
                c += '    <th>' + item + '</th>';
            });
            c += '</tr>';
            c += '{% set nu = 0 %}';
            c += '{% set cnt = 0 %}';
            c += '{% for ite in final_db["OrderNo"] %}';
            c += '        {% set cnt = cnt + 1 %}';
            c += '<tr class="tr_index">';
            c += '    <td style="padding:0;height:25px">';
            c += '        {{ cnt }}';
            c += '    </td>';
            c += '    <td style="padding:0;height:25px">';
            c += '        <button class="w3-button w3-blue w3-tiny ht_25" id="editBtn_all_data" value="{{ nu }}">run</button>';
            c += '    </td>';
            c += '    <td style="padding:0;height:25px">';
            c += '        <button class="w3-button w3-red w3-tiny ht_25" id="delBtn_all_data" value="{{ final_db["pk"][nu][0] }}">del</button>';
            c += '    </td>';
            c += '    {% for item in final_db %}';
            c += '    <td class="w3-border" style="padding:0;height:25px">';
            c += '        <input type="text" class="w3-input" name="db_all_items_{{ nu }}" value="{{ final_db[item][nu][0] }}" style="min-width:150px"></input>';
            c += '    </td>';
            c += '    {% endfor %}';
            c += '</tr>';
            c += '{% set nu = nu + 1 %}';
            c += '{% endfor %}';
            $("#nt").append(c);
        }

        function init_table_buyer() {
            { % autoescape false %
            }
            items = {
                {
                    db_data_buy
                }
            }; { % endautoescape %
            }
            c = '';
            c += '<tr style="border-top:2px solid #66b3ff">';
            c += '    <th class="w3-border">num</th>';
            c += '    <th class="w3-border">Edit</th>';
            c += '    <th class="w3-border">Delete</th>';
            items.forEach(function(item) {
                c += '    <th class="w3-border">' + item + '</th>';
            });
            c += '</tr>';
            c += '{% set nu = 0 %}';
            c += '{% set cnt = 0 %}';
            c += '{% for ite in final_db_buy["Buyer"] %}';
            c += '        {% set cnt = cnt + 1 %}';
            c += '<tr class="tr_index">';
            c += '    <td style="padding:0;height:25px">';
            c += '        {{ cnt }}';
            c += '    </td>';
            c += '    <td style="padding:0;height:25px">';
            c += '        <button class="w3-button w3-blue w3-tiny ht_25" id="editBtn" value="{{ nu }}">run</button>';
            c += '    </td>';
            c += '    <td style="padding:0;height:25px">';
            c += '        <button class="w3-button w3-red w3-tiny ht_25" id="delBtn" value="{{ final_db_buy["pk"][nu][0] }}">del</button>';
            c += '    </td>';
            c += '    {% for item in final_db_buy %}';
            c += '    <td class="w3-border" style="padding:0;height:25px">';
            c += '        <input type="text" class="w3-input" name="db_items_{{ nu }}" value="{{ final_db_buy[item][nu][0] }}" style="min-width:150px"></input>';
            c += '    </td>';
            c += '    {% endfor %}';
            c += '</tr>';
            c += '{% set nu = nu + 1 %}';
            c += '{% endfor %}';
            $("#nt_buy").append(c);
        }


        $(document).on('click', '#editBtn_all_data', function() {
            var nb = $(this).val();
            var data = $("input[name=db_all_items_" + nb + "]").serializeArray();
            dt = [];
            data.forEach(function(item) {
                dt.push(item['value']);
            });
            $.ajax({
                type: "POST",
                url: "{{ url_for('modi_all') }}",
                contentType: "application/json;charset=utf-8;",
                data: JSON.stringify({
                    inx: dt
                }),
                success: function(out) {
                    init_table();
                    init_table_buyer();
                    location.reload();

                },
                error: function() {
                    alert("err");
                }
            });
        });


        $(document).on('click', '#delBtn_all_data', function() {
            var nb = $(this).val();
            var confirmed = confirm("Are you sure to delete?");
            if (confirmed) {
                $.ajax({
                    type: "POST",
                    url: "{{ url_for('del_all_data') }}",
                    contentType: "application/json;charset=utf-8;",
                    data: JSON.stringify({
                        inx: nb
                    }),
                    success: function(out) {
                        init_table();
                        init_table_buyer();
                        location.reload();
                    },
                    error: function() {
                        alert("err");
                    }
                });
            }
        });


        $(document).on('click', '#editBtn', function() {
            var nb = $(this).val();
            var data = $("input[name=db_items_" + nb + "]").serializeArray();
            dt = [];
            data.forEach(function(item) {
                dt.push(item['value']);
            });
            $.ajax({
                type: "POST",
                url: "{{ url_for('modi_buyer') }}",
                contentType: "application/json;charset=utf-8;",
                data: JSON.stringify({
                    inx: dt
                }),
                success: function(out) {
                    init_table();
                    init_table_buyer();
                    location.reload();

                },
                error: function() {
                    alert("err");
                }
            });
        });

        $(document).on('click', '#delBtn', function() {
            var nb = $(this).val();
            var confirmed = confirm("Are you sure to delete?");
            if (confirmed) {
                $.ajax({
                    type: "POST",
                    url: "{{ url_for('del_buyer') }}",
                    contentType: "application/json;charset=utf-8;",
                    data: JSON.stringify({
                        inx: nb
                    }),
                    success: function(out) {
                        init_table();
                        init_table_buyer();
                        location.reload();
                    },
                    error: function() {
                        alert("err");
                    }
                });
            }
        });


        function add_table(data, it, nt, ref) {
            items = data["view_db"];
            c = '';
            c += '<tr style="border-top:2px solid #66b3ff">';
            c += '    <th>num</th>';
            c += '    <th>Edit</th>';
            c += '    <th>Delete</th>';
            items.forEach(function(item) {
                c += '    <th>' + item + '</th>';
            });
            c += '</tr>';
            c += '{% set nu = 0 %}';
            nu = 0;
            c += '{% set cnt = 0 %}';
            for (i = 0; i < data["data"][it].length; i++) {
                c += '<tr>';
                c += '  <td style="padding:0;height:25px">';
                c += data["data"]["pk"][i];
                c += '  </td>';
                c += '    <td style="padding:0;height:25px">';
                c += '        <button class="w3-button w3-blue w3-tiny ht_25" id="editBtn" value="' + data["data"]["pk"][i] + '">run</button>';
                c += '    </td>';
                c += '    <td style="padding:0;height:25px">';
                c += '        <button class="w3-button w3-red w3-tiny ht_25" id="delBtn" value="' + data["data"]["pk"][i] + '">del</button>';
                c += '    </td>';
                items.forEach(function(item) {
                    c += '  <td class="w3-border" style="padding:0;height:25px">';
                    c += '    <input type="text" class="w3-input" name="db_items_' + data["data"]["pk"][i] + '" value="' + data["data"][item][nu][0] + '" style="min-width:150px"></input>';
                    c += '  </td>';
                });

                c += '</tr>';
                nu++;
            }

            $(nt).append(c);

        }
    </script>

</body>

</html>